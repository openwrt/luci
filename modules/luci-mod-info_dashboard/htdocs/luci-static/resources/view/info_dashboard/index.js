'use strict';'require view';'require dom';'require network';'require rpc';document.querySelector('head').appendChild(E('link',{'rel':'stylesheet','type':'text/css','href':L.resource('view/info_dashboard/css/custom.css')}));var callSystemBoard=rpc.declare({object:'system',method:'board'}),deviceModelName='Router',activeInterval=null;function createIcon(e,t,a,n,i,c){var r=E('div',{'class':'icon-container','title':t,'style':'position: relative;'}),o=E('img',{'src':L.resource('view/info_dashboard/icons/'+e),'class':'icon','data-inactive':e,'data-active':n});r.appendChild(o);var s=E('div',{'class':'icon-label'},[i]);r.appendChild(s);var d;c&&(d=E('span',{'class':'notification-badge','style':'display: none;'},['0']),r.appendChild(d)),r.addEventListener('click',function(){resetIcons(),o.src=L.resource('view/info_dashboard/icons/'+n),s.classList.add('active'),a(d)});return{iconDiv:r,badge:d}}function resetIcons(){document.querySelectorAll('.icon-container img').forEach(function(e){e.src=L.resource('view/info_dashboard/icons/'+e.getAttribute('data-inactive'))}),document.querySelectorAll('.icon-label').forEach(function(e){e.classList.remove('active')});var e=document.querySelector('.dhcp-badge');e&&(e.style.display='block'),activeInterval&&(clearInterval(activeInterval),activeInterval=null)}return view.extend({render:function(){var e=E('div',{'class':'dashboard-container'}),t=E('div',{'id':'detail-container','class':'detail-container'});return callSystemBoard().then(function(a){a.model&&(deviceModelName=a.model);let n=createIcon('internet.png',_('Internet Connection'),function(a){L.require('view.info_dashboard.include.d_internet').then(function(n){startPolling([n],[t]),updateInternetBadge(a),activeInterval&&clearInterval(activeInterval),activeInterval=setInterval(function(){startPolling([n],[t]),updateInternetBadge(a)},15000)})},'internet_active.png',_('Internet'),!0);n.badge.classList.add('internet-badge'),e.appendChild(n.iconDiv),e.appendChild(createSeparator());let i=createIcon('devices.png',_('Device Details'),function(){L.require('view.info_dashboard.include.d_devices').then(function(n){startPolling([n],[t]),activeInterval&&clearInterval(activeInterval),activeInterval=setInterval(function(){startPolling([n],[t])},5000)})},'devices_active.png',deviceModelName,!1);e.appendChild(i.iconDiv),e.appendChild(createSeparator());let c=createIcon('dhcp.png',_('DHCP Information'),function(a){L.require('view.info_dashboard.include.d_dhcp').then(function(n){startPolling([n],[t]),updateDhcpBadge(a),activeInterval&&clearInterval(activeInterval),activeInterval=setInterval(function(){startPolling([n],[t]),updateDhcpBadge(a)},15000)})},'dhcp_active.png',_('Clients'),!0);return c.badge.classList.add('dhcp-badge'),e.appendChild(c.iconDiv),updateDhcpBadge(c.badge),updateInternetBadge(n.badge),E('div',{},[e,t])})}});function createSeparator(){return E('div',{'class':'separator'})}function updateDhcpBadge(e){L.require('view.info_dashboard.include.d_dhcp').then(function(t){t.load().then(function(t){var a=(t[0].dhcp_leases||[]).length;e&&(e.textContent=a,e.style.display='block')})})}function updateInternetBadge(e){network.getWANNetworks().then(function(t){var a=t[0]&&t[0].isUp();if(e){var n=a?'yes.png':'no.png';e.style.backgroundImage=`url(${L.resource('view/info_dashboard/icons/'+n)})`,e.style.backgroundSize='cover',e.textContent='',e.style.display='block'}})}function startPolling(e,t){var a=function(){return network.flushCache().then(function(){return invokeIncludesLoad(e)}).then(function(n){for(var i=0;i<e.length;i++)if(!e[i].failed){var c=e[i].render?e[i].render(n[i]):e[i].content;c&&(t[i].parentNode.style.display='',t[i].parentNode.classList.add('fade-in'),dom.content(t[i],c))}})};a()}function invokeIncludesLoad(e){return Promise.all(e.map(function(e){return e.load().catch(function(t){e.failed=!0,console.error('Error loading include:',t)})}))}